<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Go Practice - GoEdu</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        .tasks-section {
            padding: 20px 0;
        }

        .track-section {
            margin-bottom: 40px;
        }

        .track-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #312424;
            padding-left: 20px;
            border-left: 4px solid #007bff;
        }

        .track-slider {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding: 10px 20px;
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: #444 #1f1f1f;
        }

        .track-slider::-webkit-scrollbar {
            height: 8px;
        }
        .track-slider::-webkit-scrollbar-track {
            background: #1f1f1f;
        }
        .track-slider::-webkit-scrollbar-thumb {
            background-color: #444;
            border-radius: 4px;
        }

        .task-card {
            min-width: 260px;
            height: 160px;
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s, border-color 0.2s;
            cursor: pointer;
            border: 1px solid #444;
            color: #e0e0e0;
            text-decoration: none;
        }

        .task-card:hover {
            transform: translateY(-5px);
            border-color: #007bff;
            background: #333;
        }

        .task-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: #fff;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .task-status {
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .task-card.locked {
            opacity: 0.6;
            pointer-events: none;
            border-style: dashed;
            background: #222;
        }
        .task-card.locked .task-status { color: #888; }

        .task-card.completed {
            border-color: #28a745;
            background: #1e2e22;
        }
        .task-card.completed .task-status { color: #4ade80; }

        .task-card.active {
            border-color: #007bff;
        }
        .task-card.active .task-status { color: #61dafb; }

    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="/" class="logo">GoEdu</a>

            <nav class="main-nav" id="mainNav">
                <a href="/">Home</a>
                <a href="/handbooks">Handbooks</a>
                <a href="/go">Go</a>
                <a href="/about">About</a>
                <a href="/admin" class="admin-nav" style="display: none;">Admin</a>
            </nav>

            <a href="/profile" class="profile-img"><img src="Profile-Images/default.jpg" alt="img" class="profile-img"></a>
        </div>
    </header>

    <div class="content-wrapper">
        <main class="main-content">
            <section id="intro">
                <h2>Go Practice Arena</h2>
                <p>Select a learning track and start coding tasks to improve your Go skills.</p>
            </section>

            <section class="tasks-section">
                <div id="learning-tracks">
                    <p style="padding: 20px; color: #888;">Loading tasks...</p>
                </div>
            </section>
        </main>
    </div>

    <footer class="site-footer">
        <p>Saken Akhmediyar, Aron Davlyudov, Aslan Aldashev</p>
    </footer>

<script src="main.js"></script>
<script>
    async function loadTasks() {
        try {
            const response = await fetch('/api/tasks');
            if (!response.ok) throw new Error("Failed to load tasks");
            
            const tasks = await response.json();

            const branches = {};
            
            tasks.forEach(task => {
                const tag = task.tag || "General";
                if (!branches[tag]) {
                    branches[tag] = [];
                }
                branches[tag].push(task);
            });

            const container = document.getElementById('learning-tracks');
            container.innerHTML = ''; 

            if (Object.keys(branches).length === 0) {
                container.innerHTML = '<p style="padding: 20px;">No tasks available yet.</p>';
                return;
            }

            Object.keys(branches).forEach(tagName => {
                const tasksInBranch = branches[tagName];
                
                tasksInBranch.sort((a, b) => a.order - b.order);

                const section = document.createElement('div');
                section.className = 'track-section';

                const title = document.createElement('h2');
                title.className = 'track-title';
                title.textContent = tagName;

                const slider = document.createElement('div');
                slider.className = 'track-slider';

                tasksInBranch.forEach(task => {
                    const card = document.createElement('div');
                    
                    let statusClass = 'active';
                    let statusText = 'Start';
                    
                    if (task.isLocked) {
                        statusClass = 'locked';
                        statusText = 'Locked';
                    }
                    if (task.isCompleted) {
                        statusClass = 'completed';
                        statusText = 'Completed';
                    }
                    
                    card.className = `task-card ${statusClass}`;
                    
                    card.innerHTML = `
                        <div class="task-title">${task.title}</div>
                        <div class="task-status">${statusText}</div>
                    `;

                    if (!task.isLocked) {
                        card.onclick = () => {
                            window.location.href = `/task/${task.id}`;
                        };
                    }

                    slider.appendChild(card);
                });

                section.appendChild(title);
                section.appendChild(slider);
                container.appendChild(section);
            });

        } catch (error) {
            console.error("Error:", error);
            document.getElementById('learning-tracks').innerHTML = 
                '<div style="padding: 20px; color: #ff6b6b;">Please log in to view tasks.</div>';
        }
    }

    document.addEventListener('DOMContentLoaded', loadTasks);
</script>

</body>
</html>