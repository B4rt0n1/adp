<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - GoEdu</title>
<link rel="stylesheet" href="/style.css">

<style>
.admin-section {
  background:#fff;
  padding:20px;
  margin-bottom:2rem;
  border-radius:4px;
  box-shadow:0 2px 5px rgba(0,0,0,.05);
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  padding:10px;
  border-bottom:1px solid #eee;
}

th { background:#f5f5f5; }

.tag {
  padding:2px 8px;
  border-radius:12px;
  font-size:.75rem;
  font-weight:bold;
}

.tag.admin {
  background:#000;
  color:#fff;
}

.action-btn {
  padding:6px 10px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  background:#000;
  color:#fff;
}

.action-btn.danger { background:#b00020; }

#editModal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
}

#editBox {
  background:#fff;
  width:300px;
  margin:10% auto;
  padding:20px;
  border-radius:6px;
}
</style>
</head>

<body>
    <header class="site-header">
        <div class="container">
            <a href="/" class="logo">GoEdu</a>

            <nav class="main-nav" id="mainNav">
                <a href="/">Home</a>
                <a href="/handbooks">Handbooks</a>
                <a href="/go">Go</a>
                <a href="/about">About</a>
                <a href="/admin" class="admin-nav" style="display: none;">Admin</a>
            </nav>

            <a href="/profile" class="profile-img"><img src="Profile-Images/default.jpg" alt="img" class="profile-img"></a>
        </div>
   </header>

<h2 style="padding:20px">Admin Panel â€” User Management</h2>

<section class="admin-section">
<table id="usersTable">
<thead>
<tr>
  <th>Name</th>
  <th>Email</th>
  <th>Role</th>
  <th>Created</th>
  <th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>
</section>

<div id="editModal">
  <div id="editBox">
    <h3>Edit User</h3>
    <input type="hidden" id="editId">

    <label>Name</label>
    <input id="editName" style="width:100%">

    <label>Role</label>
    <select id="editRole" style="width:100%">
      <option value="user">User</option>
      <option value="admin">Admin</option>
    </select>

    <br><br>
    <button class="action-btn" onclick="saveUser()">Save</button>
    <button class="action-btn danger" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script src="/main.js"></script>
<script>
async function loadUsers() {
  const res = await fetch("/api/admin/users", { credentials:"same-origin" });
  const users = await res.json();

  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML = "";

  users.forEach(u => {
    tbody.innerHTML += `
    <tr>
      <td>${u.name}</td>
      <td>${u.email}</td>
      <td><span class="tag ${u.role==="admin"?"admin":""}">${u.role}</span></td>
      <td>${new Date(u.createdAt).toISOString().split("T")[0]}</td>
      <td>
        <button class="action-btn" onclick="openEdit('${u.id}','${u.name}','${u.role}')">Edit</button>
        <button class="action-btn danger" onclick="deleteUser('${u.id}')">Delete</button>
      </td>
    </tr>`;
  });
}

function openEdit(id,name,role){
  editId.value=id;
  editName.value=name;
  editRole.value=role;
  editModal.style.display="block";
}

function closeModal(){
  editModal.style.display="none";
}

async function saveUser(){
  await fetch("/api/admin/users/"+editId.value,{
    method:"PUT",
    credentials:"same-origin",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      name:editName.value,
      role:editRole.value
    })
  });
  closeModal();
  loadUsers();
}

async function deleteUser(id){
  if(!confirm("Delete user?")) return;
  await fetch("/api/admin/users/"+id,{
    method:"DELETE",
    credentials:"same-origin"
  });
  loadUsers();
}

loadUsers();
</script>

</body>
</html>